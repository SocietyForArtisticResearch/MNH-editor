<html>
    <head>
	<link rel="stylesheet" id="dynStylesheet" href=""/>
	<script src="../lib/nearley/nearley.js"></script>
	<script src="../lib/markdown-it/markdown-it.js"></script>
	<script src="../parser/rclangparser.js"></script>
	<script src="../lib/rcexposition.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
			  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
			  crossorigin="anonymous"></script>
    <script src="tinymce/js/tinymce/tinymce.min.js"></script>
    <script src="Sortable/Sortable.js"></script>
    <style>
    body {
        font-family: Helvetica,Arial,sans-serif; 

    }

    .text-edit-area {
        display:block;
    }

    li {background-color:#fff}
    li:nth-child(odd) {background:#eee}

    #form-tool-list {
        width:50%;
        list-style-type:none;
    }

    button {
        font-size:14px;
        padding:5px;
        background: rgba(0,0,0,0.0);
        color: inherit;
        border: none;
        cursor: pointer;
        outline: inherit !important;
    }

    .create-tool-button {
        background: #80ff80;
        box-shadow: 2px 2px 2px #888888;;
    }

    .form-tool-name {
    }

    #createText {
        margin-left:120px;
    }

    </style>

    </head>


    <body>
    <h1> test exposition </h1>
    <ul id="form-tool-list">
    </ul>

    <button class="create-tool-button" id="createText" type="button" onclick="createText();">+ create text</button>
   

		
	<div id="weave">
	</div>

    </body>
    


    <script>

    /** 
     * The exposition is a list.
     * tools are represented by boxes in that list.
     */

     /**
      * list view
      * Cell for index
      * Number of cells
      * refresh table
      */ 

    class FormRCObject {
        constructor(id) {
            this.id = id;
        }

        content ( ) {
            return "";
        }

        render ( ) {
            return "<div>"+content()+"</div>"
        }
    }

    class FormTextRCObject extends FormRCObject {
        content( ) {
            return "Tool";
        }
    }

    class Listview {
        constructor(dataSource) {
            this.__classname = "Listview";
            this.dataSource = dataSource;
        }

        numberOfCells ( ) {
           return dataSource.length;
        }

        cellForIndex (index) {
            let cell = Cell( );
            //cell.setValues(); Probably based on something with the dataSource
            return cell;
        }

        refresh ( ) {
            for (var i = 0; i<numberOfCells() ;i++) {
                let cell = cellForIndex(i);
                cell.render();
            }
        }
    }

    let expositionModel = [];

    /**
     * Create a text edit object, the actual text is edited in a box.
     * 
     */

    var createText = function ( ) {
        let id = "text-tool-"+uniqueID();
        // Add the class attribute to <h1> 
        let name = document.createElement('span');
        name.innerHTML = id.replace(' ','-');
        name.setAttribute('class','form-tool-name');

        let textBlock = document.createElement('li');
        document.getElementById('form-tool-list').appendChild(textBlock);
        textBlock.id = id;

        var textEditBlock = false;

        let editTool = function ( ) { 
            if(textEditBlock) {
                document.removeChild(textEditBlock);
                textEditBlock = false;
                return;
            } 
            let textEditBoxId = id + '-textEditBox';
            textEditBlock = createTextEditBox(textEditBoxId,'placeholder text');
            textBlock.appendChild(textEditBlock);
            tinymce.init({
                selector:'#'+textEditBoxId
            });
        };

        let removeTool = function ( ) { 
            removeElement(textBlock);
        };

        textBlock.appendChild(name);
        textBlock.appendChild(createButton('textEdit','edit',editTool));
        textBlock.appendChild(createButton('textRemove','remove',removeTool));
    };

    var createTextEditBox = function (id,innerText) {
        let textArea = document.createElement('textarea');
        textArea.setAttribute('rows','25');
        textArea.setAttribute('cols','80');
        textArea.id = id;
        textArea.setAttribute('class','text-edit-area');
        return textArea;
    }

    var removeElement = function(element) {
        element.parentNode.removeChild(element);
    }

    var createButton = function(id,innerText,clickAction) {
        let button = document.createElement('button');
        button.innerHTML = innerText;
        button.onclick = clickAction;
        return button;
    };

    var makeListSortable = function() {
        let list = document.getElementById('form-tool-list');
        console.log('my list');
        console.log(list);
        Sortable.create(list);
    }

    makeListSortable();

/*

let textEditBox = document.createElement('textarea');
    textEditBox.id = "myText";
    document.body.appendChild(textEditBox);
    tinymce.init({
        selector:'#myText',
        plugins:['link','code'],
        width:'650px',
        height:'500px'
    });

// define objects
let ob1 = new RCText("text tool 1", 1, 1, "hello world");
let ob2 = new RCImage("leonardo", 1, 2, "media/leonardo.jpg");
let ob3 = new RCText("text tool 2", 2, 2, "some more *stuff*");

// an object in the same cell as ob3 (will be fused)
let ob4 = new RCText("text tool 3", 2, 2, "and even more **stuff**");

// define grid
let grid = new RCGrid(2,2);

// create a weave
let weave1 = new RCWeave(grid, "w1", [ob1, ob2, ob3, ob4]);

// create exposition
let exposition = new RCExposition("title of expo", ["Jane Doe"], "", [weave1]);

// render
exposition.renderResponsive();
*/
	
</script>    
</html>
